<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miss Banaras - Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Dancing+Script:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --primary-color: #F2B134; /* Warm gold */
            --secondary-color: #D35269; /* Soft pink/rose */
            --ghat-color: #8B6E4E; /* Rich sandstone */
            --ghat-highlight: #A68B68; /* Lighter sandstone */
            --accent-color: #E1673C; /* Rich vermilion */
            --dark-color: #221A31; /* Deep indigo */
            --light-color: #FFF8E8; /* Warm white */
            --temple-color: #D9B17D; /* Sandstone */
            --water-color: #4C96D7; /* Ganges blue */
            --text-color: #333333; /* Dark gray for text */
            --btn-gradient: linear-gradient(135deg, #F2B134, #D35269); /* Button gradient */
            --error-color: #B22222; /* Rich red for errors */
            --success-color: #228B22; /* Lush green for success */
        }
    
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            color: var(--text-color);
            background: linear-gradient(135deg, #F8F1E5, #FFF8E8);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .leaves-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 1.5rem 3rem;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(255, 248, 232, 0.95);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.5s;
        }

        .logo {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--secondary-color);
            text-decoration: none;
            position: relative;
            display: inline-block;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--secondary-color), transparent);
            transition: width 0.3s ease;
        }

        .logo:hover::after {
            width: 100%;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-link {
            margin: 0 1.2rem;
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            position: relative;
            transition: all 0.3s;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent-color);
            transition: width 0.3s ease;
        }

        .nav-link:hover {
            color: var(--accent-color);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .menu-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
        }

        .menu-toggle span {
            width: 25px;
            height: 3px;
            background-color: var(--dark-color);
            margin: 3px 0;
            transition: all 0.3s ease;
        }

        .menu-toggle.active span:nth-child(1) {
            transform: translateY(9px) rotate(45deg);
        }

        .menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .menu-toggle.active span:nth-child(3) {
            transform: translateY(-9px) rotate(-45deg);
        }

        .timer-container {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: var(--accent-color);
            background: rgba(255, 255, 255, 0.8);
            padding: 0.5rem 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .timer-container span {
            font-weight: 600;
            color: var(--dark-color);
        }

        .main-container {
            width: 100%;
            min-height: 100vh;
            padding-top: 100px;
            padding-bottom: 60px;
            display: flex;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .form-container {
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 1000px;
            padding: 2rem;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .form-heading {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--dark-color) 30%, var(--secondary-color) 70%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .form-subheading {
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            color: var(--accent-color);
            text-align: center;
            margin-bottom: 2rem;
        }

        .stepper {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .stepper::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 6px;
            background: rgba(211, 82, 105, 0.1);
            transform: translateY(-50%);
            z-index: 0;
            border-radius: 3px;
        }

        .stepper .step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .stepper .step-circle {
            width: 40px;
            height: 40px;
            background: rgba(211, 82, 105, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .stepper .step.active .step-circle {
            background: var(--accent-color);
            color: white;
            transform: scale(1.1);
        }

        .stepper .step.completed .step-circle {
            background: var(--success-color);
            color: white;
        }

        .stepper .step-title {
            font-size: 1rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 1rem;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(211, 82, 105, 0.2);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(242, 177, 52, 0.2);
        }

        .input-field.error {
            border-color: var(--error-color);
        }

        textarea.input-field {
            min-height: 120px;
            resize: vertical;
        }

        .hint-text {
            font-size: 0.85rem;
            color: var(--text-color);
            margin-top: 6px;
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.85rem;
            margin-top: 6px;
            display: none;
        }

        .columns-2 {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .columns-2 .input-group {
            flex: 1 1 calc(50% - 10px);
            min-width: 200px;
        }

        .btn {
            padding: 0.8rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 25px;
            background: var(--btn-gradient);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(211, 82, 105, 0.3);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(211, 82, 105, 0.4);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
            z-index: 1;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:disabled {
            background: rgba(211, 82, 105, 0.3);
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-row {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .google-btn {
            background: white;
            color: var(--dark-color);
            border: 1px solid rgba(211, 82, 105, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .google-btn i {
            color: #4285F4;
            font-size: 1.2rem;
        }

        .google-btn:hover {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .logout-btn {
            background: linear-gradient(to right, #B22222, #FF4040);
            margin-top: 20px;
        }

        .next-btn {
            background: var(--btn-gradient);
            margin-top: 25px;
            padding: 0.8rem 2rem;
            font-size: 1rem;
        }

        .photo-upload-container {
            border: 2px dashed rgba(211, 82, 105, 0.2);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
        }

        .photo-upload-container:hover {
            border-color: var(--primary-color);
            background: rgba(242, 177, 52, 0.05);
        }

        .upload-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .photo-upload-text {
            font-weight: 500;
            font-size: 1.1rem;
            margin-bottom: 6px;
        }

        .photo-requirements {
            font-size: 0.85rem;
            color: var(--text-color);
        }

        .file-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .progress-bar {
            height: 10px;
            background: rgba(211, 82, 105, 0.1);
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: var(--btn-gradient);
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-message {
            font-size: 0.95rem;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .photo-swatch {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .gallery-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(211, 82, 105, 0.2);
        }

        .gallery-img:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-color);
        }

        .gallery-img-container {
            position: relative;
            animation: fadeIn 0.5s ease;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(211, 82, 105, 0.2);
            margin-bottom: 25px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-family: 'Cinzel', serif;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .tab.active {
            border-bottom: 3px solid var(--accent-color);
            color: var(--accent-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease forwards;
        }

        .success-message {
            background: rgba(34, 139, 34, 0.1);
            border-left: 4px solid var(--success-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: var(--success-color);
            display: none;
            font-size: 1rem;
        }

        .success-message i {
            margin-right: 8px;
        }

        .selected-file {
            margin-top: 10px;
            color: var(--accent-color);
            font-weight: 500;
            display: none;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
            margin-left: 10px;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid rgba(242, 177, 52, 0.3);
        }

        .user-info h3 {
            font-family: 'Cinzel', serif;
            color: var(--secondary-color);
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .user-info p {
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            color: var(--text-color);
        }

        .user-info p strong {
            width: 140px;
            color: var(--accent-color);
        }

        .user-info h4 {
            font-family: 'Cinzel', serif;
            color: var(--dark-color);
            font-size: 1.4rem;
            margin: 20px 0 12px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .modal-img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.3s ease;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .submitted-data {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
        }

        .submitted-data p {
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            color: var(--text-color);
        }

        .submitted-data p strong {
            width: 140px;
            color: var(--accent-color);
        }

        .banaras-silhouette {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M985.66,92.83C906.67,72,823.78,31,743.84,14.19c-82.26-17.34-168.06-16.33-250.45.39-57.84,11.73-114,31.07-172,41.86A600.21,600.21,0,0,1,0,27.35V120H1200V95.8C1132.19,118.92,1055.71,111.31,985.66,92.83Z' fill='%238B6E4E' fill-opacity='0.2'%3E%3C/path%3E%3Cpath d='M50 50 L100 40 L150 60 L200 45 L250 55 L300 35 L350 60 L400 40 L450 55 L500 45 L550 65 L600 30 L650 55 L700 40 L750 60 L800 35 L850 50 L900 30 L950 55 L1000 45 L1050 65 L1100 40 L1150 50 L1200 40 L1200 120 L0 120 L0 70 Z' fill='%238B6E4E' fill-opacity='0.15'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-repeat: no-repeat;
            pointer-events: none;
        }

        footer {
            background-color: rgba(255, 248, 232, 0.95);
            padding: 1rem 2rem;
            text-align: center;
            border-top: 1px solid rgba(211, 82, 105, 0.1);
            margin-top: auto;
        }

        .footer-text {
            color: var(--text-color);
            font-size: 0.85rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animated {
            animation: fadeIn 0.5s ease forwards;
        }

        @media (max-width: 768px) {
            header {
                padding: 1rem 1.5rem;
                flex-wrap: wrap;
                justify-content: space-between;
            }

            .logo {
                font-size: 1.5rem;
            }

            .timer-container {
                font-size: 0.9rem;
                margin-top: 0.5rem;
                padding: 0.4rem 0.8rem;
            }

            .menu-toggle {
                display: flex;
            }

            .nav-links {
                position: fixed;
                top: 0;
                right: -100%;
                width: 80%;
                height: 100vh;
                background-color: rgba(255, 255, 255, 0.95);
                flex-direction: column;
                justify-content: center;
                align-items: center;
                transition: right 0.5s ease;
                z-index: 100;
                box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            }

            .nav-links.active {
                right: 0;
            }

            .nav-link {
                margin: 1.2rem 0;
                font-size: 1.1rem;
            }

            .main-container {
                padding-top: 80px;
            }

            .form-container {
                padding: 1.2rem;
                margin: 20px 10px;
                width: 95%;
            }

            .form-heading {
                font-size: 1.8rem;
            }

            .form-subheading {
                font-size: 1.4rem;
            }

            .stepper .step-circle {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            .stepper .step-title {
                font-size: 0.9rem;
            }

            .input-field {
                padding: 10px 14px;
                font-size: 0.9rem;
            }

            .btn {
                padding: 0.7rem 1.5rem;
                font-size: 0.9rem;
            }

            .btn-row {
                flex-direction: column;
                gap: 10px;
            }

            .columns-2 .input-group {
                flex: 1 1 100%;
            }

            .photo-upload-container {
                padding: 20px;
            }

            .photo-swatch {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 10px;
            }

            .gallery-img {
                height: 80px;
            }

            .user-info p strong,
            .submitted-data p strong {
                width: 100px;
            }

            .preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .preview-item {
                width: 80px;
                height: 80px;
            }
        }

        @media (max-width: 576px) {
            header {
                padding: 0.8rem 1rem;
            }

            .logo {
                font-size: 1.3rem;
            }

            .timer-container {
                font-size: 0.8rem;
                padding: 0.3rem 0.6rem;
            }

            .form-container {
                padding: 1rem;
                margin: 15px 5px;
            }

            .form-heading {
                font-size: 1.5rem;
            }

            .form-subheading {
                font-size: 1.2rem;
            }

            .input-field {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.85rem;
            }

            .photo-upload-container {
                padding: 15px;
            }

            .photo-swatch {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            }

            .gallery-img {
                height: 70px;
            }
        }

        @media (max-width: 400px) {
            .form-heading {
                font-size: 1.3rem;
            }

            .form-subheading {
                font-size: 1rem;
            }

            .stepper .step-circle {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }

            .stepper .step-title {
                font-size: 0.8rem;
            }
        }

        .btn-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .next-btn {
            padding: 0.8rem 2rem;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .btn-row {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 10px;
            }
            .next-btn {
                margin-left: 0;
                width: auto;
                max-width: none;
            }
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .next-auth-btn {
            background: var(--btn-gradient);
            color: white;
            flex: 1;
            max-width: 250px;
        }

        .logout-btn {
            background: linear-gradient(to right, #B22222, #FF4040);
            flex: 1;
            max-width: 150px;
        }

        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin: 15px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(211, 82, 105, 0.2);
            max-height: 220px;
            overflow-y: auto;
        }

        .preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            background: white;
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .preview-item:hover {
            transform: translateY(-2px);
        }

        .preview-item:hover img {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <header>
        <a href="https://banarasia.site/" class="logo">Miss Banaras</a>
        <div class="timer-container">
            Results Announce In: <span id="countdown-timer"></span>
        </div>
        <div class="menu-toggle" id="menu-toggle">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <ul class="nav-links" id="nav-links">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li><a href="aboutus.html" class="nav-link">About</a></li>
            <li><a href="reward.html" class="nav-link">Rewards</a></li>
            <li><a href="Criteria.html" class="nav-link">Criteria</a></li>
            <li><a href="Register.html" class="nav-link">Register</a></li>
            <li><a href="contact.html" class="nav-link">Contact</a></li>
        </ul>
    </header>

    <canvas class="leaves-canvas" id="leaves-canvas"></canvas>

    <div class="main-container">
        <div class="form-container" id="form-container">
            <h1 class="form-heading">Miss Banaras Dashboard</h1>
            <h2 class="form-subheading">Manage Your Registration</h2>

            <div class="stepper" id="stepper">
                <div class="step active" data-step="auth">
                    <div class="step-circle">1</div>
                    <div class="step-title">Authentication</div>
                </div>
                <div class="step" data-step="registration">
                    <div class="step-circle">2</div>
                    <div class="step-title">Registration</div>
                </div>
                <div class="step" data-step="upload">
                    <div class="step-circle">3</div>
                    <div class="step-title">Photo Upload</div>
                </div>
            </div>

            <div class="tabs" id="tabs">
                <div class="tab active" data-tab="auth">Authentication</div>
                <div class="tab" data-tab="registration">Registration Form</div>
                <div class="tab" data-tab="upload">Photo Upload</div>
            </div>

            <div class="tab-content active" id="auth-tab">
                <div class="auth-section" id="auth-section" style="animation:fadeIn 0.5s ease">
                    <div class="input-group">
                        <label for="email" class="input-label">Email Address*</label>
                        <input type="email" id="email" class="input-field" placeholder="Enter your email address" required>
                        <div class="error-message" id="email-error">Please enter a valid email address</div>
                    </div>

                    <div class="input-group">
                        <label for="password" class="input-label">Password*</label>
                        <input type="password" id="password" class="input-field" placeholder="Create a password" required>
                        <div class="hint-text">Minimum 6 characters</div>
                        <div class="error-message" id="password-error">Password must be at least 6 characters</div>
                    </div>

                    <div class="btn-row">
                        <button id="signUp" class="btn">
                            <span class="btn-text"><i class="fas fa-user-plus"></i> Sign Up</span>
                            <div class="loader" id="signup-loader"></div>
                        </button>
                        <button id="login" class="btn">
                            <span class="btn-text"><i class="fas fa-sign-in-alt"></i> Login</span>
                            <div class="loader" id="login-loader"></div>
                        </button>
                    </div>

                    <button id="googleSignIn" class="btn google-btn">
                        <i class="fab fa-google"></i> Sign in with Google
                        <div class="loader" id="google-loader"></div>
                    </button>

                    <div class="success-message" id="auth-success" style="display:none">
                        <i class="fas fa-check-circle"></i> <span id="auth-greeting"></span>
                    </div>

                    <button id="nextBtn" class="btn next-btn" style="display:none; margin-top: 25px; width: 100%; max-width: 300px; margin-left: auto; margin-right: auto;">
                        <span class="btn-text"><i class="fas fa-arrow-right"></i>Registration Form</span>
                    </button>
                </div>

                <div id="userData" class="user-info" style="display:none;"></div>

                <div class="auth-buttons">
                    <button id="nextToRegistration" class="btn next-auth-btn" style="display:none;">
                        <i class="fas fa-arrow-right"></i> Next: Registration Form
                    </button>
                    <button id="logout" style="display:none;" class="btn logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
            </div>

            <div class="tab-content" id="registration-tab">
                <div id="submittedData" class="submitted-data" style="display:none;"></div>
                <form id="registration-form" style="display:block;">
                    <h2 class="form-subheading">Personal Information</h2>

                    <div class="columns-2">
                        <div class="input-group">
                            <label for="full-name" class="input-label">Full Name*</label>
                            <input type="text" id="full-name" class="input-field" placeholder="Enter your full name" required>
                            <div class="error-message" id="full-name-error">Name is required</div>
                        </div>

                        <div class="input-group">
                            <label for="age" class="input-label">Age*</label>
                            <input type="number" id="age" class="input-field" placeholder="Enter your age" min="14" max="30" required>
                            <div class="error-message" id="age-error">Age must be between 14 and 30</div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="city" class="input-label">City*</label>
                        <input type="text" id="city" class="input-field" placeholder="Enter your city" required>
                        <div class="error-message" id="city-error">City is required</div>
                    </div>

                    <div class="input-group">
                        <label for="bio" class="input-label">Brief Bio*</label>
                        <textarea id="bio" class="input-field" placeholder="Tell us about yourself, your interests, and aspirations (Max 200 words)" required></textarea>
                        <div class="hint-text" id="bio-counter">0/200 words</div>
                        <div class="error-message" id="bio-error">Bio is required (max 200 words)</div>
                    </div>

                    <h2 class="form-subheading">Contest Details</h2>

                    <div class="input-group">
                        <label for="experience" class="input-label">What’s one thing you’re super passionate about?</label>
                        <textarea id="experience" class="input-field" placeholder="Share your previous pageant or modeling experience"></textarea>
                    </div>

                    <div class="input-group">
                        <label for="talents" class="input-label">Special Talents*</label>
                        <input type="text" id="talents" class="input-field" placeholder="Dancing, Singing, Nothing💅 etc." required>
                        <div class="error-message" id="talents-error">Please list at least one talent</div>
                    </div>

                    <h2 class="form-subheading">Personal Questions</h2>

                    <div class="input-group">
                        <label for="recent-feeling" class="input-label">What's something you've recently felt strongly about, and why do you think it mattered so much to you?*</label>
                        <textarea id="recent-feeling" class="input-field" placeholder="Share your thoughts and feelings about a recent experience or issue that deeply affected you..." required></textarea>
                        <div class="hint-text" id="recent-feeling-counter">0/250 words</div>
                        <div class="error-message" id="recent-feeling-error">Response is required (max 250 words)</div>
                    </div>

                    <div class="input-group">
                        <label for="self-understanding" class="input-label">What's something you wish people understood better about you, and how does that affect the way you interact with others?*</label>
                        <textarea id="self-understanding" class="input-field" placeholder="Tell us about an aspect of yourself that you feel is often misunderstood..." required></textarea>
                        <div class="hint-text" id="self-understanding-counter">0/250 words</div>
                        <div class="error-message" id="self-understanding-error">Response is required (max 250 words)</div>
                    </div>

                    <div class="input-group">
                        <label for="decision-making" class="input-label">When you're faced with a tough decision, how do you usually work through it?*</label>
                        <textarea id="decision-making" class="input-field" placeholder="Describe your approach to making difficult decisions..." required></textarea>
                        <div class="hint-text" id="decision-making-counter">0/250 words</div>
                        <div class="error-message" id="decision-making-error">Response is required (max 250 words)</div>
                    </div>

                    <div class="btn-row" style="margin-top:25px;">
                        <button type="button" class="btn" onclick="saveDraft()">
                            <span class="btn-text"><i class="fas fa-save"></i> Save Draft</span>
                        </button>
                        <button type="submit" class="btn">
                            <span class="btn-text"><i class="fas fa-paper-plane"></i> Submit Registration</span>
                        </button>
                    </div>
                </form>
                <button id="nextToUpload" class="btn next-btn" style="display:none;margin-top:20px;">
                    <span class="btn-text"><i class="fas fa-arrow-right"></i> Next to Upload</span>
                </button>
            </div>
        

            <div class="tab-content" id="upload-tab">
                <div id="uploadSection" style="display:none;">
                    <h2 class="form-subheading">Submit Your Photos (Max 15)</h2>
                    <p class="hint-text">Upload up to 15 clear, high-quality photos. These will be used for the first round of selection.</p>

                    <div class="photo-upload-container" id="dropArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="photo-upload-text">Click or drop to upload your photos</div>
                        <div class="photo-requirements">Maximum 5MB each (JPEG or PNG), Up to 15 photos</div>
                        <input type="file" id="fileInput" class="file-input" accept="image/*" multiple>
                    </div>

                    <div class="selected-file" id="selectedFile"></div>

                    <progress id="uploadProgress" value="0" max="100" style="display:none;width:100%;"></progress>
                    <p id="status" class="status-message"></p>

                    <div id="preview" style="display:none;" class="preview-grid"></div>

                    <button id="uploadBtn" class="btn" onclick="uploadImages()">
                        <span class="btn-text"><i class="fas fa-upload"></i> Upload Photos</span>
                        <div class="loader" id="upload-loader"></div>
                    </button>

                    <div class="success-message" id="upload-success">
                        <i class="fas fa-check-circle"></i> Photos uploaded successfully! Your application is complete.
                    </div>

                    <h2 class="form-subheading">Uploaded Photos</h2>
                    <div id="gallery" class="photo-swatch"></div>
                </div>
            </div>
        </div>
        <div class="banaras-silhouette"></div>
    </div>

    <div class="modal" id="imageModal">
        <div class="modal-content">
            <img class="modal-img" id="modalImg" src="" alt="Full-size image">
            <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <footer>
        <p class="footer-text">© 2025 Miss Banaras Competition. All rights reserved.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, update, onValue, push, set, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCAImdjvo3yjfsxwwGKZp5iDx5VwmhfaDs",
            authDomain: "contact-us-page-missbanaras.firebaseapp.com",
            databaseURL: "https://contact-us-page-missbanaras-default-rtdb.firebaseio.com",
            projectId: "contact-us-page-missbanaras",
            messagingSenderId: "323394332678",
            appId: "1:323394332678:web:99dde90fa03bf6c85ebb87",
            measurementId: "G-6MWHVZ5KG9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const BACKEND_URL = "https://miss-banaras-backend.onrender.com";
        const MAX_UPLOADS = 15;

        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const signUpBtn = document.getElementById("signUp");
        const loginBtn = document.getElementById("login");
        const googleBtn = document.getElementById("googleSignIn");
        const logoutBtn = document.getElementById("logout");
        const nextBtn = document.getElementById("nextBtn");
        const userDataDiv = document.getElementById("userData");
        const statusText = document.getElementById("status");
        const progressBar = document.getElementById("uploadProgress");
        const uploadBtn = document.getElementById("uploadBtn");
        const fileInput = document.getElementById("fileInput");
        const selectedFileDisplay = document.getElementById("selectedFile");
        const preview = document.getElementById("preview");
        const gallery = document.getElementById("gallery");
        const stepper = document.getElementById("stepper");
        const imageModal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImg");
        const registrationForm = document.getElementById("registration-form");
        const submittedDataDiv = document.getElementById("submittedData");
        const nextToUploadBtn = document.getElementById("nextToUpload");
        const authGreeting = document.getElementById("auth-greeting");
        const nextToRegistrationBtn = document.getElementById("nextToRegistration");

        let currentUser = null;
        let uploadedCount = 0;
        let isRegistrationComplete = false;

        // Countdown Timer
        function startCountdown() {
            const resultDate = new Date('May 25, 2025 00:00:00').getTime();
            const timerElement = document.getElementById('countdown-timer');

            function updateTimer() {
                const now = new Date().getTime();
                const distance = resultDate - now;

                if (distance < 0) {
                    timerElement.innerHTML = "Results Announced!";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                timerElement.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }

            updateTimer();
            setInterval(updateTimer, 1000);
        }


        // Initialize countdown timer
        document.addEventListener('DOMContentLoaded', startCountdown);

        // Three.js Leaves Animation
        const initLeavesAnimation = () => {
            const canvas = document.getElementById('leaves-canvas');
            const renderer = new THREE.WebGLRenderer({
                canvas,
                alpha: true,
                antialias: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            
            const scene = new THREE.Scene();
            
            const camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.z = 20;
            
            const createLeafGeometry = () => {
                const shape = new THREE.Shape();
                shape.moveTo(0, -0.7);
                shape.bezierCurveTo(0.5, -0.5, 1.0, 0.0, 0.7, 1.0);
                shape.bezierCurveTo(0.5, 1.2, -0.5, 1.2, -0.7, 1.0);
                shape.bezierCurveTo(-1.0, 0.0, -0.5, -0.5, 0, -0.7);
                const midrib = new THREE.Shape();
                midrib.moveTo(0, -0.7);
                midrib.lineTo(0, 1.0);
                const geometry = new THREE.ShapeGeometry(shape);
                const position = geometry.attributes.position;
                const vertex = new THREE.Vector3();
                for (let i = 0; i < position.count; i++) {
                    vertex.fromBufferAttribute(position, i);
                    if (Math.abs(vertex.x) > 0.05) {
                        vertex.z += Math.sin(vertex.y * 5) * 0.05 * Math.abs(vertex.x);
                    }
                    position.setXYZ(i, vertex.x, vertex.y, vertex.z);
                }
                geometry.computeVertexNormals();
                return geometry;
            };
            
            const leavesCount = 75;
            const leaves = [];
            const leafColors = [
                0xA8631C, 0xD49D42, 0x8B4513, 0xCD853F, 0xDEB887,
                0xD2691E, 0xB8860B, 0xDAA520, 0xA0522D, 0x8A360F
            ];
            
            for (let i = 0; i < leavesCount; i++) {
                const leafGeometry = createLeafGeometry();
                const colorIndex = Math.floor(Math.random() * leafColors.length);
                const leafMaterial = new THREE.MeshLambertMaterial({ 
                    color: leafColors[colorIndex],
                    transparent: true,
                    opacity: 0.8,
                    side: THREE.DoubleSide
                });
                const leaf = new THREE.Mesh(leafGeometry, leafMaterial);
                leaf.position.x = (Math.random() - 0.5) * window.innerWidth / 15;
                leaf.position.y = Math.random() * window.innerHeight / 8 + 15;
                leaf.position.z = (Math.random() - 0.5) * 15;
                leaf.rotation.x = Math.random() * Math.PI;
                leaf.rotation.y = Math.random() * Math.PI;
                leaf.rotation.z = Math.random() * Math.PI;
                const scale = Math.random() * 0.6 + 0.2;
                leaf.scale.set(scale, scale * (0.8 + Math.random() * 0.4), scale);
                leaf.velocity = {
                    x: (Math.random() - 0.5) * 0.07,
                    y: -Math.random() * 0.07 - 0.02,
                    z: (Math.random() - 0.5) * 0.02,
                    rotationX: (Math.random() - 0.5) * 0.015,
                    rotationY: (Math.random() - 0.5) * 0.015,
                    rotationZ: (Math.random() - 0.5) * 0.02
                };
                leaf.spinFactor = Math.random() * 2 + 1;
                leaf.oscillationSpeed = Math.random() * 0.01 + 0.005;
                leaf.oscillationAmplitude = Math.random() * 0.1 + 0.05;
                leaf.phaseOffset = Math.random() * Math.PI * 2;
                scene.add(leaf);
                leaves.push(leaf);
            }
            
            const ambientLight = new THREE.AmbientLight(0xcccccc, 0.4);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            let lastTime = 0;
            const animate = (currentTime) => {
                requestAnimationFrame(animate);
                const deltaTime = lastTime ? (currentTime - lastTime) / 1000 : 0.016;
                lastTime = currentTime;
                leaves.forEach(leaf => {
                    leaf.velocity.y -= 0.005 * deltaTime;
                    leaf.velocity.x *= 0.995;
                    leaf.velocity.y *= 0.995;
                    leaf.velocity.z *= 0.995;
                    leaf.position.x += leaf.velocity.x;
                    leaf.position.y += leaf.velocity.y;
                    leaf.position.z += leaf.velocity.z;
                    leaf.rotation.x += leaf.velocity.rotationX * leaf.spinFactor * deltaTime;
                    leaf.rotation.y += leaf.velocity.rotationY * leaf.spinFactor * deltaTime;
                    leaf.rotation.z += leaf.velocity.rotationZ * leaf.spinFactor * deltaTime;
                    const oscillation = Math.sin(currentTime * leaf.oscillationSpeed + leaf.phaseOffset);
                    leaf.position.x += oscillation * leaf.oscillationAmplitude;
                    if (Math.random() < 0.02) {
                        leaf.velocity.x += (Math.random() - 0.5) * 0.1;
                        leaf.velocity.z += (Math.random() - 0.5) * 0.1;
                    }
                    if (leaf.position.y < -window.innerHeight / 10) {
                        leaf.position.y = window.innerHeight / 8 + Math.random() * 5;
                        leaf.position.x = (Math.random() - 0.5) * window.innerWidth / 15;
                        leaf.position.z = (Math.random() - 0.5) * 15;
                        leaf.velocity.y = -Math.random() * 0.07 - 0.02;
                        leaf.velocity.x = (Math.random() - 0.5) * 0.07;
                        leaf.velocity.z = (Math.random() - 0.5) * 0.02;
                    }
                });
                renderer.render(scene, camera);
            };
            
            animate(0);
            
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            document.addEventListener('mousemove', (event) => {
                const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                const mouseY = (event.clientY / window.innerHeight) * 2 - 1;
                leaves.forEach(leaf => {
                    leaf.velocity.x += mouseX * 0.001;
                    leaf.velocity.z -= mouseY * 0.001;
                });
            });
            
            document.addEventListener('touchmove', (event) => {
                if (event.touches.length > 0) {
                    const touch = event.touches[0];
                    const mouseX = (touch.clientX / window.innerWidth) * 2 - 1;
                    const mouseY = (touch.clientY / window.innerHeight) * 2 - 1;
                    leaves.forEach(leaf => {
                        leaf.velocity.x += mouseX * 0.002;
                        leaf.velocity.z -= mouseY * 0.002;
                    });
                }
            });
        };



        // Initialize leaves animation
        document.addEventListener('DOMContentLoaded', () => {
            initLeavesAnimation();
            ScrollTrigger.batch(".input-group, .btn", {
                onEnter: batch => gsap.to(batch, {
                    y: 0,
                    opacity: 1,
                    stagger: 0.15,
                    duration: 0.8,
                    ease: "back.out(1.7)"
                }),
                start: "top 80%"
            });
        });

        // Menu toggle functionality
        document.getElementById("menu-toggle").addEventListener("click", function() {
            document.getElementById("nav-links").classList.toggle("active");
            this.classList.toggle("active");
        });

        // Firebase and form functionality
        function saveUserData(user) {
            console.log("Saving user data for UID:", user.uid);
            update(ref(db, "users/" + user.uid), {
                email: user.email,
                uid: user.uid,
                name: user.displayName || "Anonymous"
            }).catch(err => console.error("Error saving user data:", err));
        }

        function fetchUserData(uid) {
            console.log("Fetching user data for UID:", uid);
            onValue(ref(db, "users/" + uid), (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    isRegistrationComplete = !!data.registration;
                    let uploadsHtml = "";
                    uploadedCount = data.uploads ? Object.keys(data.uploads).length : 0;
                    if (data.uploads) {
                        uploadsHtml = "<h4>Your Uploaded Photos:</h4><div class='photo-swatch'>";
                        Object.entries(data.uploads).forEach(([key, upload]) => {
                            uploadsHtml += `
                                <div class="gallery-img-container">
                                    <img src="${upload.secure_url}" class="gallery-img" onclick="openModal('${upload.secure_url}')">
                                </div>
                            `;
                        });
                        uploadsHtml += "</div>";
                    }
                    userDataDiv.innerHTML = `
                        <h3>Welcome, ${data.name}!</h3>
                        <p><strong>Email:</strong> ${data.email}</p>
                        <p><strong>Uploaded Photos:</strong> ${uploadedCount}/${MAX_UPLOADS}</p>
                        ${!isRegistrationComplete ? '<p style="color: var(--error-color);"><strong>Note:</strong> Please complete the registration form to unlock photo uploads.</p>' : ''}
                        ${uploadsHtml}
                    `;
                    userDataDiv.style.display = "block";
                    document.getElementById("auth-success").style.display = "block";
                    authGreeting.innerText = `Welcome, ${data.name}! You are now authenticated.`;
                    gallery.innerHTML = uploadsHtml;
                    displaySubmittedData(data.registration);
                }
            }, err => console.error("Error fetching user data:", err));
        }

        function displaySubmittedData(registration) {
            if (registration) {
                submittedDataDiv.innerHTML = `
                    <h3>Submitted Registration</h3>
                    <p><strong>Full Name:</strong> ${registration.fullName}</p>
                    <p><strong>Age:</strong> ${registration.age}</p>
                    <p><strong>City:</strong> ${registration.city}</p>
                    <p><strong>Bio:</strong> ${registration.bio}</p>
                    <p><strong>Experience:</strong> ${registration.experience || 'None'}</p>
                    <p><strong>Talents:</strong> ${registration.talents}</p>
                    <p><strong>Recent Feeling:</strong> ${registration.recentFeeling}</p>
                    <p><strong>Self Understanding:</strong> ${registration.selfUnderstanding}</p>
                    <p><strong>Decision Making:</strong> ${registration.decisionMaking}</p>
                `;
                submittedDataDiv.style.display = "block";
                registrationForm.style.display = "none";
                nextToUploadBtn.style.display = "block";
            } else {
                submittedDataDiv.style.display = "none";
                registrationForm.style.display = "block";
                nextToUploadBtn.style.display = "none";
                loadDraft();
            }
        }

        async function checkDuplicatePhoto(uid, fileName) {
            const snapshot = await get(ref(db, `users/${uid}/uploads`));
            if (snapshot.exists()) {
                const uploads = snapshot.val();
                return Object.values(uploads).some(upload => upload.public_id.includes(fileName));
            }
            return false;
        }

        function saveUploadData(uid, imageData) {
            console.log("Saving upload data for UID:", uid);
            const uploadRef = push(ref(db, `users/${uid}/uploads`));
            set(uploadRef, {
                public_id: imageData.public_id,
                secure_url: imageData.secure_url,
                timestamp: imageData.created_at,
                user_uid: currentUser.uid,
                user_name: currentUser.displayName || "Anonymous"
            }).catch(err => console.error("Error saving upload data:", err));
        }

        window.openModal = (src) => {
            modalImg.src = src;
            imageModal.style.display = "flex";
        };

        window.closeModal = () => {
            imageModal.style.display = "none";
            modalImg.src = "";
        };

        signUpBtn.addEventListener("click", () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            if (!email || !password) {
                alert("Please enter email and password.");
                return;
            }
            signUpBtn.disabled = true;
            document.getElementById("signup-loader").style.display = "block";

            createUserWithEmailAndPassword(auth, email, password)
                .then((cred) => {
                    saveUserData(cred.user);
                    fetchUserData(cred.user.uid);
                    nextBtn.style.display = "block";
                    nextBtn.disabled = false;
                })
                .catch((err) => {
                    alert("Sign-up failed: " + err.message);
                })
                .finally(() => {
                    signUpBtn.disabled = false;
                    document.getElementById("signup-loader").style.display = "none";
                });
        });

        loginBtn.addEventListener("click", () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            if (!email || !password) {
                alert("Please enter email and password.");
                return;
            }
            loginBtn.disabled = true;
            document.getElementById("login-loader").style.display = "block";

            signInWithEmailAndPassword(auth, email, password)
                .then((cred) => {
                    fetchUserData(cred.user.uid);
                    nextBtn.style.display = "block";
                    nextBtn.disabled = false;
                })
                .catch((err) => {
                    alert("Login failed: " + err.message);
                })
                .finally(() => {
                    loginBtn.disabled = false;
                    document.getElementById("login-loader").style.display = "none";
                });
        });

        googleBtn.addEventListener("click", () => {
            const provider = new GoogleAuthProvider();
            googleBtn.disabled = true;
            document.getElementById("google-loader").style.display = "block";

            signInWithPopup(auth, provider)
                .then((result) => {
                    saveUserData(result.user);
                    fetchUserData(result.user.uid);
                    nextBtn.style.display = "block";
                    nextBtn.disabled = false;
                })
                .catch((err) => {
                    alert("Google Sign-In failed: " + err.message);
                })
                .finally(() => {
                    googleBtn.disabled = false;
                    document.getElementById("google-loader").style.display = "none";
                });
        });

        nextBtn.addEventListener("click", () => {
            if (!nextBtn.disabled) {
                document.querySelector('.tab[data-tab="registration"]').click();
            }
        });

        logoutBtn.addEventListener("click", () => {
            signOut(auth)
                .then(() => {
                    userDataDiv.style.display = "none";
                    userDataDiv.innerHTML = "";
                    emailInput.value = "";
                    passwordInput.value = "";
                    progressBar.style.display = "none";
                    statusText.innerText = "";
                    preview.style.display = "none";
                    gallery.innerHTML = "";
                    document.getElementById("auth-success").style.display = "none";
                    nextBtn.style.display = "none";
                    nextBtn.disabled = true;
                    currentUser = null;
                    isRegistrationComplete = false;
                    logoutBtn.style.display = "none";
                    signUpBtn.style.display = "block";
                    loginBtn.style.display = "block";
                    googleBtn.style.display = "block";
                    document.getElementById("uploadSection").style.display = "none";
                    document.getElementById("auth-section").style.display = "block";
                    submittedDataDiv.style.display = "none";
                    registrationForm.style.display = "block";
                    nextToUploadBtn.style.display = "none";
                    nextToRegistrationBtn.style.display = "none";
                    document.querySelector('.tab[data-tab="auth"]').click();
                })
                .catch((err) => alert("Logout failed: " + err.message));
        });

        fileInput.addEventListener("change", function() {
            const files = Array.from(this.files);
            if (files.length + uploadedCount > MAX_UPLOADS) {
                alert(`You can upload a maximum of ${MAX_UPLOADS} photos. You have already uploaded ${uploadedCount}.`);
                this.value = "";
                return;
            }
            if (files.length === 0) return;

            selectedFileDisplay.textContent = files.map(f => f.name).join(", ");
            selectedFileDisplay.style.display = "block";

            preview.innerHTML = "";
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement("div");
                    previewItem.className = "preview-item";
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.alt = file.name;
                    previewItem.appendChild(img);
                    preview.appendChild(previewItem);
                };
                reader.readAsDataURL(file);
            });
            preview.style.display = "block";
        });

        const dropArea = document.getElementById("dropArea");
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropArea.classList.add('highlight');
        }

        function unhighlight() {
            dropArea.classList.remove('highlight');
        }

        dropArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length + uploadedCount > MAX_UPLOADS) {
                alert(`You can upload a maximum of ${MAX_UPLOADS} photos. You have already uploaded ${uploadedCount}.`);
                return;
            }
            fileInput.files = files;
            fileInput.dispatchEvent(new Event('change'));
        }

        window.uploadImages = async () => {
            if (!currentUser) {
                alert("Please log in to upload images.");
                return;
            }

            if (!isRegistrationComplete) {
                alert("Please complete the registration form before uploading photos.");
                document.querySelector('.tab[data-tab="registration"]').click();
                return;
            }

            const files = Array.from(fileInput.files);
            if (files.length === 0) {
                alert("Please select at least one file to upload.");
                return;
            }

            if (files.length + uploadedCount > MAX_UPLOADS) {
                alert(`You can upload a maximum of ${MAX_UPLOADS} photos. You have already uploaded ${uploadedCount}.`);
                return;
            }

            for (const file of files) {
                if (!file.type.startsWith("image/")) {
                    alert(`"${file.name}" is not an image file.`);
                    return;
                }
                if (file.size > 5 * 1024 * 1024) {
                    alert(`"${file.name}" is too large (max 5MB).`);
                    return;
                }
                const isDuplicate = await checkDuplicatePhoto(currentUser.uid, file.name);
                if (isDuplicate) {
                    alert(`"${file.name}" has already been uploaded.`);
                    return;
                }
            }

            statusText.innerText = "Preparing upload...";
            progressBar.style.display = "block";
            progressBar.value = 0;
            uploadBtn.disabled = true;

            try {
                const sigResponse = await fetch(`${BACKEND_URL}/generate-signature`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        user_uid: currentUser.uid,
                        user_name: currentUser.displayName || "Anonymous"
                    })
                });

                if (!sigResponse.ok) {
                    const errorText = await sigResponse.text();
                    throw new Error(`Failed to fetch signature: ${sigResponse.status} - ${errorText}`);
                }

                const sigData = await sigResponse.json();
                if (!sigData.signature) {
                    throw new Error("Invalid signature response from server");
                }

                let uploadedFiles = [];
                let uploaded = 0;

                for (const file of files) {
                    const formData = new FormData();
                    formData.append("file", file);
                    formData.append("upload_preset", "signed_upload");
                    formData.append("timestamp", sigData.timestamp);
                    formData.append("signature", sigData.signature);
                    formData.append("api_key", sigData.api_key);
                    formData.append("context", `user_uid=${sigData.user_uid}|user_name=${sigData.user_name}`);

                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", `https://api.cloudinary.com/v1_1/${sigData.cloud_name}/image/upload`, true);

                    xhr.upload.onprogress = (event) => {
                        if (event.lengthComputable) {
                            const percent = (event.loaded / event.total) * 100 / files.length + (uploaded / files.length) * 100;
                            progressBar.value = percent;
                            statusText.innerText = `Uploading: ${Math.round(percent)}%`;
                        }
                    };

                    await new Promise((resolve, reject) => {
                        xhr.onload = () => {
                            if (xhr.status >= 200 && xhr.status < 300) {
                                try {
                                    const data = JSON.parse(xhr.responseText);
                                    if (data.secure_url) {
                                        saveUploadData(currentUser.uid, data);
                                        uploaded++;
                                        uploadedFiles.push({ fileName: file.name, secure_url: data.secure_url });
                                        resolve();
                                    } else {
                                        reject(new Error("Upload response missing URL"));
                                    }
                                } catch (e) {
                                    reject(new Error("Failed to parse upload response"));
                                }
                            } else {
                                reject(new Error(`Upload failed with status: ${xhr.status}`));
                            }
                        };

                        xhr.onerror = () => reject(new Error("Network error during upload"));
                        xhr.send(formData);
                    });
                }

                const remainingFiles = Array.from(fileInput.files).filter(f => !uploadedFiles.some(uf => uf.fileName === f.name));
                const dataTransfer = new DataTransfer();
                remainingFiles.forEach(f => dataTransfer.items.add(f));
                fileInput.files = dataTransfer.files;

                preview.innerHTML = "";
                remainingFiles.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewItem = document.createElement("div");
                        previewItem.className = "preview-item";
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        img.alt = file.name;
                        previewItem.appendChild(img);
                        preview.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                });
                if (remainingFiles.length === 0) {
                    preview.style.display = "none";
                    selectedFileDisplay.style.display = "none";
                    selectedFileDisplay.textContent = "";
                }

                uploadedFiles.forEach(({ secure_url }) => {
                    const imgContainer = document.createElement("div");
                    imgContainer.className = "gallery-img-container";
                    const img = document.createElement("img");
                    img.src = secure_url;
                    img.className = "gallery-img";
                    img.onclick = () => openModal(secure_url);
                    imgContainer.appendChild(img);
                    gallery.appendChild(imgContainer);
                });

                statusText.innerText = "✅ All photos uploaded successfully!";
                document.getElementById("upload-success").style.display = "block";

            } catch (err) {
                statusText.innerText = "❌ Upload failed: " + err.message;
                console.error("Upload error:", err);
            } finally {
                progressBar.style.display = "none";
                uploadBtn.disabled = false;
            }
        };

        window.saveDraft = () => {
            const formData = {
                fullName: document.getElementById("full-name").value,
                age: document.getElementById("age").value,
                city: document.getElementById("city").value,
                bio: document.getElementById("bio").value,
                experience: document.getElementById("experience").value,
                talents: document.getElementById("talents").value,
                recentFeeling: document.getElementById("recent-feeling").value,
                selfUnderstanding: document.getElementById("self-understanding").value,
                decisionMaking: document.getElementById("decision-making").value
            };
            localStorage.setItem("registrationDraft", JSON.stringify(formData));
            alert("Draft saved successfully!");
        };

        function loadDraft() {
            const draft = localStorage.getItem("registrationDraft");
            if (draft) {
                try {
                    const formData = JSON.parse(draft);
                    document.getElementById("full-name").value = formData.fullName || "";
                    document.getElementById("age").value = formData.age || "";
                    document.getElementById("city").value = formData.city || "";
                    document.getElementById("bio").value = formData.bio || "";
                    document.getElementById("experience").value = formData.experience || "";
                    document.getElementById("talents").value = formData.talents || "";
                    document.getElementById("recent-feeling").value = formData.recentFeeling || "";
                    document.getElementById("self-understanding").value = formData.selfUnderstanding || "";
                    document.getElementById("decision-making").value = formData.decisionMaking || "";
                    updateWordCounters();
                    console.log("Draft loaded:", formData);
                } catch (err) {
                    console.error("Error loading draft:", err);
                }
            }
        }

        function updateWordCounters() {
            const fields = [
                { id: "bio", max: 200, counterId: "bio-counter" },
                { id: "recent-feeling", max: 250, counterId: "recent-feeling-counter" },
                { id: "self-understanding", max: 250, counterId: "self-understanding-counter" },
                { id: "decision-making", max: 250, counterId: "decision-making-counter" }
            ];

            fields.forEach(({ id, max, counterId }) => {
                const value = document.getElementById(id).value;
                const words = value.trim().split(/\s+/).filter(word => word.length > 0).length;
                document.getElementById(counterId).textContent = `${words}/${max} words`;
                if (words > max) {
                    document.getElementById(`${id}-error`).style.display = "block";
                } else {
                    document.getElementById(`${id}-error`).style.display = "none";
                }
            });
        }

        document.getElementById("bio").addEventListener("input", updateWordCounters);
        document.getElementById("recent-feeling").addEventListener("input", updateWordCounters);
        document.getElementById("self-understanding").addEventListener("input", updateWordCounters);
        document.getElementById("decision-making").addEventListener("input", updateWordCounters);

        document.getElementById("registration-form").addEventListener("submit", async function(e) {
        e.preventDefault();

        if (!currentUser) {
            alert("Please log in to submit your registration.");
            return;
        }

        const fullName = document.getElementById("full-name").value;
        const age = document.getElementById("age").value;
        const city = document.getElementById("city").value;
        const bio = document.getElementById("bio").value;
        const talents = document.getElementById("talents").value;
        const recentFeeling = document.getElementById("recent-feeling").value;
        const selfUnderstanding = document.getElementById("self-understanding").value;
        const decisionMaking = document.getElementById("decision-making").value;
        const experience = document.getElementById("experience").value;

        if (!fullName || !age || !city || !bio || !talents || !recentFeeling || !selfUnderstanding || !decisionMaking) {
            alert("Please fill all required fields marked with *");
            return;
        }

        if (parseInt(age) < 13 || parseInt(age) > 30) {
            document.getElementById("age-error").style.display = "block";
            return;
        }

        const bioWords = bio.trim().split(/\s+/).filter(word => word.length > 0).length;
        if (bioWords > 200) {
            document.getElementById("bio-error").style.display = "block";
            return;
        }

        const recentFeelingWords = recentFeeling.trim().split(/\s+/).filter(word => word.length > 0).length;
        if (recentFeelingWords > 250) {
            document.getElementById("recent-feeling-error").style.display = "block";
            return;
        }

        const selfUnderstandingWords = selfUnderstanding.trim().split(/\s+/).filter(word => word.length > 0).length;
        if (selfUnderstandingWords > 250) {
            document.getElementById("self-understanding-error").style.display = "block";
            return;
        }

        const decisionMakingWords = decisionMaking.trim().split(/\s+/).filter(word => word.length > 0).length;
        if (decisionMakingWords > 250) {
            document.getElementById("decision-making-error").style.display = "block";
            return;
        }

        // Save registration data to Firebase
        try {
            const registrationData = {
                fullName,
                age,
                city,
                bio,
                experience: experience || "None",
                talents,
                recentFeeling,
                selfUnderstanding,
                decisionMaking,
                submittedAt: new Date().toISOString()
            };

            await update(ref(db, `users/${currentUser.uid}/registration`), registrationData);
            isRegistrationComplete = true;
            localStorage.removeItem("registrationDraft"); // Clear draft after successful submission

            // Update UI
            submittedDataDiv.innerHTML = `
                <h3>Submitted Registration</h3>
                <p><strong>Full Name:</strong> ${fullName}</p>
                <p><strong>Age:</strong> ${age}</p>
                <p><strong>City:</strong> ${city}</p>
                <p><strong>Bio:</strong> ${bio}</p>
                <p><strong>Experience:</strong> ${experience || "None"}</p>
                <p><strong>Talents:</strong> ${talents}</p>
                <p><strong>Recent Feeling:</strong> ${recentFeeling}</p>
                <p><strong>Self Understanding:</strong> ${selfUnderstanding}</p>
                <p><strong>Decision Making:</strong> ${decisionMaking}</p>
            `;
            submittedDataDiv.style.display = "block";
            registrationForm.style.display = "none";
            nextToUploadBtn.style.display = "block";

            // Update stepper
            document.querySelector('.step[data-step="registration"]').classList.add("completed");
            document.querySelector('.step[data-step="upload"]').classList.add("active");

            // Show success message
            const successMessage = document.createElement("div");
            successMessage.className = "success-message";
            successMessage.innerHTML = '<i class="fas fa-check-circle"></i> Registration submitted successfully!';
            registrationForm.parentElement.insertBefore(successMessage, registrationForm);
            successMessage.style.display = "block";
            setTimeout(() => {
                successMessage.style.display = "none";
            }, 3000);

        } catch (err) {
            console.error("Error saving registration data:", err);
            alert("Failed to submit registration: " + err.message);
        }
    });

    // Tab navigation
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            if (tab.dataset.tab === "registration" && !currentUser) {
                alert("Please authenticate first.");
                return;
            }
            if (tab.dataset.tab === "upload" && (!currentUser || !isRegistrationComplete)) {
                alert("Please complete registration before uploading photos.");
                return;
            }

            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');

            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.querySelector(`.step[data-step="${tab.dataset.tab}"]`).classList.add('active');

            if (tab.dataset.tab === "upload") {
                document.getElementById("uploadSection").style.display = "block";
            } else {
                document.getElementById("uploadSection").style.display = "none";
            }
        });
    });

    // Next to Upload button
    nextToUploadBtn.addEventListener("click", () => {
        document.querySelector('.tab[data-tab="upload"]').click();
    });

    // Auth state listener
    onAuthStateChanged(auth, (user) => {
    if (user) {
        currentUser = user;
        fetchUserData(user.uid);
        nextToRegistrationBtn.style.display = "block";
        logoutBtn.style.display = "block";
        signUpBtn.style.display = "none";
        loginBtn.style.display = "none";
        googleBtn.style.display = "none";
        document.getElementById("auth-section").style.display = "none";
        nextBtn.style.display = "inline-block"; // Ensure nextBtn is visible
        nextBtn.disabled = false;
    } else {
        currentUser = null;
        userDataDiv.style.display = "none";
        logoutBtn.style.display = "none";
        signUpBtn.style.display = "block";
        loginBtn.style.display = "block";
        googleBtn.style.display = "block";
        document.getElementById("auth-section").style.display = "block";
        nextBtn.style.display = "none"; // Hide nextBtn when not authenticated
        submittedDataDiv.style.display = "none";
        registrationForm.style.display = "block";
        nextToUploadBtn.style.display = "none";
        nextToRegistrationBtn.style.display = "none";
        document.getElementById("uploadSection").style.display = "none";
        document.querySelector('.tab[data-tab="auth"]').click();
    }
});

    // Next to Registration button
    nextToRegistrationBtn.addEventListener("click", () => {
        document.querySelector('[data-tab="registration"]').click();
    });

    // Initialize form with draft data
    document.addEventListener('DOMContentLoaded', () => {
        loadDraft();
        updateWordCounters();
    });
</script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>